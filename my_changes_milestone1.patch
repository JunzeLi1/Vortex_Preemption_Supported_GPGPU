diff --git a/.gitignore b/.gitignore
index e188b4c..fab0a04 100644
--- a/.gitignore
+++ b/.gitignore
@@ -3,3 +3,4 @@
 *.cache
 *.code-workspace
 miscs/apptainer/vortex.sif
+tests/
diff --git a/hw/VX_config.h b/hw/VX_config.h
index f912dae..fab0b89 100644
--- a/hw/VX_config.h
+++ b/hw/VX_config.h
@@ -1,5 +1,5 @@
 // auto-generated by gen_config.py. DO NOT EDIT
-// Generated at 2025-11-16 21:13:46.029961
+// Generated at 2025-11-19 20:52:43.565549
 
 // Translated from /home/andyl/vortex/hw/rtl/VX_config.vh:
 
diff --git a/hw/VX_types.h b/hw/VX_types.h
index f03815f..82b7f67 100644
--- a/hw/VX_types.h
+++ b/hw/VX_types.h
@@ -1,5 +1,5 @@
 // auto-generated by gen_config.py. DO NOT EDIT
-// Generated at 2025-11-16 21:13:46.054437
+// Generated at 2025-11-19 20:52:43.589307
 
 // Translated from /home/andyl/vortex/hw/rtl/VX_types.vh:
 
diff --git a/runtime/libsimx.so b/runtime/libsimx.so
index 2315c00..6a18b72 100755
Binary files a/runtime/libsimx.so and b/runtime/libsimx.so differ
diff --git a/runtime/libvortex-simx.so b/runtime/libvortex-simx.so
index 9c95d67..4ebceb7 100755
Binary files a/runtime/libvortex-simx.so and b/runtime/libvortex-simx.so differ
diff --git a/runtime/obj/cache_sim.o b/runtime/obj/cache_sim.o
index 538b3fb..2f5be78 100644
Binary files a/runtime/obj/cache_sim.o and b/runtime/obj/cache_sim.o differ
diff --git a/runtime/obj/cluster.d b/runtime/obj/cluster.d
index 99ab0ec..588942f 100644
--- a/runtime/obj/cluster.d
+++ b/runtime/obj/cluster.d
@@ -20,9 +20,8 @@
  /home/andyl/vortex/sim/simx/core.h \
  /home/andyl/vortex/sim/simx/emulator.h \
  /home/andyl/vortex/sim/common/mem.h /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
- /home/andyl/vortex/sim/simx/instr_trace.h \
  /home/andyl/vortex/sim/simx/pipeline.h \
+ /home/andyl/vortex/sim/simx/instr_trace.h \
  /home/andyl/vortex/sim/simx/ibuffer.h \
  /home/andyl/vortex/sim/simx/scoreboard.h \
  /home/andyl/vortex/sim/simx/operands.h \
@@ -54,9 +53,8 @@
 /home/andyl/vortex/sim/simx/emulator.h:
 /home/andyl/vortex/sim/common/mem.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
-/home/andyl/vortex/sim/simx/instr_trace.h:
 /home/andyl/vortex/sim/simx/pipeline.h:
+/home/andyl/vortex/sim/simx/instr_trace.h:
 /home/andyl/vortex/sim/simx/ibuffer.h:
 /home/andyl/vortex/sim/simx/scoreboard.h:
 /home/andyl/vortex/sim/simx/operands.h:
diff --git a/runtime/obj/cluster.o b/runtime/obj/cluster.o
index 0e3f6ce..e3edf3f 100644
Binary files a/runtime/obj/cluster.o and b/runtime/obj/cluster.o differ
diff --git a/runtime/obj/common/dram_sim.o b/runtime/obj/common/dram_sim.o
index 56ab547..be2f41b 100644
Binary files a/runtime/obj/common/dram_sim.o and b/runtime/obj/common/dram_sim.o differ
diff --git a/runtime/obj/common/mem.o b/runtime/obj/common/mem.o
index fa1787f..06b9ae4 100644
Binary files a/runtime/obj/common/mem.o and b/runtime/obj/common/mem.o differ
diff --git a/runtime/obj/common/rvfloats.o b/runtime/obj/common/rvfloats.o
index 93241f0..0996800 100644
Binary files a/runtime/obj/common/rvfloats.o and b/runtime/obj/common/rvfloats.o differ
diff --git a/runtime/obj/common/softfloat_ext.o b/runtime/obj/common/softfloat_ext.o
index 5cffe0b..2a4bbbc 100644
Binary files a/runtime/obj/common/softfloat_ext.o and b/runtime/obj/common/softfloat_ext.o differ
diff --git a/runtime/obj/common/util.o b/runtime/obj/common/util.o
index 1a8622d..4810d4e 100644
Binary files a/runtime/obj/common/util.o and b/runtime/obj/common/util.o differ
diff --git a/runtime/obj/core.d b/runtime/obj/core.d
index c2d6efd..114664c 100644
--- a/runtime/obj/core.d
+++ b/runtime/obj/core.d
@@ -15,9 +15,8 @@
  /home/andyl/vortex/sim/simx/core.h \
  /home/andyl/vortex/sim/simx/emulator.h \
  /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
- /home/andyl/vortex/sim/simx/instr_trace.h \
  /home/andyl/vortex/sim/simx/pipeline.h \
+ /home/andyl/vortex/sim/simx/instr_trace.h \
  /home/andyl/vortex/sim/simx/cache_sim.h \
  /home/andyl/vortex/sim/simx/mem_sim.h \
  /home/andyl/vortex/sim/simx/local_mem.h \
@@ -45,9 +44,8 @@
 /home/andyl/vortex/sim/simx/core.h:
 /home/andyl/vortex/sim/simx/emulator.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
-/home/andyl/vortex/sim/simx/instr_trace.h:
 /home/andyl/vortex/sim/simx/pipeline.h:
+/home/andyl/vortex/sim/simx/instr_trace.h:
 /home/andyl/vortex/sim/simx/cache_sim.h:
 /home/andyl/vortex/sim/simx/mem_sim.h:
 /home/andyl/vortex/sim/simx/local_mem.h:
diff --git a/runtime/obj/core.o b/runtime/obj/core.o
index adad835..928d403 100644
Binary files a/runtime/obj/core.o and b/runtime/obj/core.o differ
diff --git a/runtime/obj/dcrs.o b/runtime/obj/dcrs.o
index 4bc7b4f..bef6688 100644
Binary files a/runtime/obj/dcrs.o and b/runtime/obj/dcrs.o differ
diff --git a/runtime/obj/decode.d b/runtime/obj/decode.d
index 2930575..8431368 100644
--- a/runtime/obj/decode.d
+++ b/runtime/obj/decode.d
@@ -12,10 +12,7 @@
  /home/andyl/vortex/sim/simx/constants.h \
  /home/andyl/vortex/sim/simx/emulator.h \
  /home/andyl/vortex/sim/common/mem.h /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
- /home/andyl/vortex/sim/simx/instr_trace.h \
- /home/andyl/vortex/sim/simx/arch.h \
- /home/andyl/vortex/sim/common/tensor_cfg.h
+ /home/andyl/vortex/sim/simx/arch.h
 /home/andyl/vortex/sim/common/util.h:
 /home/andyl/vortex/sim/common/bitmanip.h:
 /home/andyl/vortex/sim/simx/debug.h:
@@ -31,7 +28,4 @@
 /home/andyl/vortex/sim/simx/emulator.h:
 /home/andyl/vortex/sim/common/mem.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
-/home/andyl/vortex/sim/simx/instr_trace.h:
 /home/andyl/vortex/sim/simx/arch.h:
-/home/andyl/vortex/sim/common/tensor_cfg.h:
diff --git a/runtime/obj/decode.o b/runtime/obj/decode.o
index 2f947b3..78e6734 100644
Binary files a/runtime/obj/decode.o and b/runtime/obj/decode.o differ
diff --git a/runtime/obj/dispatcher.d b/runtime/obj/dispatcher.d
index 82f1896..c88fb62 100644
--- a/runtime/obj/dispatcher.d
+++ b/runtime/obj/dispatcher.d
@@ -16,7 +16,6 @@
  /home/andyl/vortex/sim/simx/arch.h /home/andyl/vortex/sim/simx/core.h \
  /home/andyl/vortex/sim/simx/emulator.h \
  /home/andyl/vortex/sim/common/mem.h /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
  /home/andyl/vortex/sim/simx/pipeline.h \
  /home/andyl/vortex/sim/simx/cache_sim.h \
  /home/andyl/vortex/sim/simx/mem_sim.h \
@@ -46,7 +45,6 @@
 /home/andyl/vortex/sim/simx/emulator.h:
 /home/andyl/vortex/sim/common/mem.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
 /home/andyl/vortex/sim/simx/pipeline.h:
 /home/andyl/vortex/sim/simx/cache_sim.h:
 /home/andyl/vortex/sim/simx/mem_sim.h:
diff --git a/runtime/obj/dispatcher.o b/runtime/obj/dispatcher.o
index 1ed5e4a..bce2c32 100644
Binary files a/runtime/obj/dispatcher.o and b/runtime/obj/dispatcher.o differ
diff --git a/runtime/obj/emulator.d b/runtime/obj/emulator.d
index 90e178a..853f289 100644
--- a/runtime/obj/emulator.d
+++ b/runtime/obj/emulator.d
@@ -14,7 +14,6 @@
  /home/andyl/vortex/sim/simx/debug.h \
  /home/andyl/vortex/sim/simx/constants.h \
  /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
  /home/andyl/vortex/sim/simx/instr_trace.h \
  /home/andyl/vortex/sim/simx/arch.h /home/andyl/vortex/sim/simx/dcrs.h \
  /home/andyl/vortex/sim/simx/core.h \
@@ -48,7 +47,6 @@
 /home/andyl/vortex/sim/simx/debug.h:
 /home/andyl/vortex/sim/simx/constants.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
 /home/andyl/vortex/sim/simx/instr_trace.h:
 /home/andyl/vortex/sim/simx/arch.h:
 /home/andyl/vortex/sim/simx/dcrs.h:
diff --git a/runtime/obj/emulator.o b/runtime/obj/emulator.o
index 4893c1e..7ca56db 100644
Binary files a/runtime/obj/emulator.o and b/runtime/obj/emulator.o differ
diff --git a/runtime/obj/execute.d b/runtime/obj/execute.d
index 3461a13..e85f571 100644
--- a/runtime/obj/execute.d
+++ b/runtime/obj/execute.d
@@ -14,11 +14,10 @@
  /home/andyl/vortex/sim/common/bitvector.h \
  /home/andyl/vortex/sim/simx/debug.h \
  /home/andyl/vortex/sim/simx/constants.h \
- /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
- /home/andyl/vortex/sim/simx/instr_trace.h \
- /home/andyl/vortex/sim/simx/arch.h /home/andyl/vortex/sim/simx/core.h \
+ /home/andyl/vortex/sim/simx/instr.h /home/andyl/vortex/sim/simx/core.h \
  /home/andyl/vortex/sim/simx/pipeline.h \
+ /home/andyl/vortex/sim/simx/instr_trace.h \
+ /home/andyl/vortex/sim/simx/arch.h \
  /home/andyl/vortex/sim/simx/cache_sim.h \
  /home/andyl/vortex/sim/simx/mem_sim.h \
  /home/andyl/vortex/sim/simx/local_mem.h \
@@ -45,11 +44,10 @@
 /home/andyl/vortex/sim/simx/debug.h:
 /home/andyl/vortex/sim/simx/constants.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
-/home/andyl/vortex/sim/simx/instr_trace.h:
-/home/andyl/vortex/sim/simx/arch.h:
 /home/andyl/vortex/sim/simx/core.h:
 /home/andyl/vortex/sim/simx/pipeline.h:
+/home/andyl/vortex/sim/simx/instr_trace.h:
+/home/andyl/vortex/sim/simx/arch.h:
 /home/andyl/vortex/sim/simx/cache_sim.h:
 /home/andyl/vortex/sim/simx/mem_sim.h:
 /home/andyl/vortex/sim/simx/local_mem.h:
diff --git a/runtime/obj/execute.o b/runtime/obj/execute.o
index d98829f..a483f51 100644
Binary files a/runtime/obj/execute.o and b/runtime/obj/execute.o differ
diff --git a/runtime/obj/func_unit.d b/runtime/obj/func_unit.d
index 8d934a4..38ef8fa 100644
--- a/runtime/obj/func_unit.d
+++ b/runtime/obj/func_unit.d
@@ -16,7 +16,6 @@
  /home/andyl/vortex/sim/simx/arch.h /home/andyl/vortex/sim/simx/core.h \
  /home/andyl/vortex/sim/simx/emulator.h \
  /home/andyl/vortex/sim/common/mem.h /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
  /home/andyl/vortex/sim/simx/pipeline.h \
  /home/andyl/vortex/sim/simx/cache_sim.h \
  /home/andyl/vortex/sim/simx/mem_sim.h \
@@ -46,7 +45,6 @@
 /home/andyl/vortex/sim/simx/emulator.h:
 /home/andyl/vortex/sim/common/mem.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
 /home/andyl/vortex/sim/simx/pipeline.h:
 /home/andyl/vortex/sim/simx/cache_sim.h:
 /home/andyl/vortex/sim/simx/mem_sim.h:
diff --git a/runtime/obj/func_unit.o b/runtime/obj/func_unit.o
index ba60a99..965c7fb 100644
Binary files a/runtime/obj/func_unit.o and b/runtime/obj/func_unit.o differ
diff --git a/runtime/obj/local_mem.d b/runtime/obj/local_mem.d
index 9463b7d..a24649f 100644
--- a/runtime/obj/local_mem.d
+++ b/runtime/obj/local_mem.d
@@ -15,10 +15,9 @@
  /home/andyl/vortex/sim/simx/core.h \
  /home/andyl/vortex/sim/simx/emulator.h \
  /home/andyl/vortex/sim/common/mem.h /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
+ /home/andyl/vortex/sim/simx/pipeline.h \
  /home/andyl/vortex/sim/simx/instr_trace.h \
  /home/andyl/vortex/sim/simx/arch.h \
- /home/andyl/vortex/sim/simx/pipeline.h \
  /home/andyl/vortex/sim/simx/cache_sim.h \
  /home/andyl/vortex/sim/simx/mem_sim.h \
  /home/andyl/vortex/sim/simx/ibuffer.h \
@@ -45,10 +44,9 @@
 /home/andyl/vortex/sim/simx/emulator.h:
 /home/andyl/vortex/sim/common/mem.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
+/home/andyl/vortex/sim/simx/pipeline.h:
 /home/andyl/vortex/sim/simx/instr_trace.h:
 /home/andyl/vortex/sim/simx/arch.h:
-/home/andyl/vortex/sim/simx/pipeline.h:
 /home/andyl/vortex/sim/simx/cache_sim.h:
 /home/andyl/vortex/sim/simx/mem_sim.h:
 /home/andyl/vortex/sim/simx/ibuffer.h:
diff --git a/runtime/obj/local_mem.o b/runtime/obj/local_mem.o
index b02d967..3179532 100644
Binary files a/runtime/obj/local_mem.o and b/runtime/obj/local_mem.o differ
diff --git a/runtime/obj/mem_coalescer.o b/runtime/obj/mem_coalescer.o
index 761350f..ea617b9 100644
Binary files a/runtime/obj/mem_coalescer.o and b/runtime/obj/mem_coalescer.o differ
diff --git a/runtime/obj/mem_sim.o b/runtime/obj/mem_sim.o
index 6281829..9077da6 100644
Binary files a/runtime/obj/mem_sim.o and b/runtime/obj/mem_sim.o differ
diff --git a/runtime/obj/opc_unit.d b/runtime/obj/opc_unit.d
index a183f7f..7d0ce86 100644
--- a/runtime/obj/opc_unit.d
+++ b/runtime/obj/opc_unit.d
@@ -16,7 +16,6 @@
  /home/andyl/vortex/sim/simx/arch.h /home/andyl/vortex/sim/simx/core.h \
  /home/andyl/vortex/sim/simx/emulator.h \
  /home/andyl/vortex/sim/common/mem.h /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
  /home/andyl/vortex/sim/simx/pipeline.h \
  /home/andyl/vortex/sim/simx/cache_sim.h \
  /home/andyl/vortex/sim/simx/mem_sim.h \
@@ -46,7 +45,6 @@
 /home/andyl/vortex/sim/simx/emulator.h:
 /home/andyl/vortex/sim/common/mem.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
 /home/andyl/vortex/sim/simx/pipeline.h:
 /home/andyl/vortex/sim/simx/cache_sim.h:
 /home/andyl/vortex/sim/simx/mem_sim.h:
diff --git a/runtime/obj/opc_unit.o b/runtime/obj/opc_unit.o
index 72cc84b..3ca6445 100644
Binary files a/runtime/obj/opc_unit.o and b/runtime/obj/opc_unit.o differ
diff --git a/runtime/obj/operands.d b/runtime/obj/operands.d
index 4c9f869..b830cac 100644
--- a/runtime/obj/operands.d
+++ b/runtime/obj/operands.d
@@ -18,7 +18,6 @@
  /home/andyl/vortex/sim/simx/core.h \
  /home/andyl/vortex/sim/simx/emulator.h \
  /home/andyl/vortex/sim/common/mem.h /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
  /home/andyl/vortex/sim/simx/pipeline.h \
  /home/andyl/vortex/sim/simx/cache_sim.h \
  /home/andyl/vortex/sim/simx/mem_sim.h \
@@ -48,7 +47,6 @@
 /home/andyl/vortex/sim/simx/emulator.h:
 /home/andyl/vortex/sim/common/mem.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
 /home/andyl/vortex/sim/simx/pipeline.h:
 /home/andyl/vortex/sim/simx/cache_sim.h:
 /home/andyl/vortex/sim/simx/mem_sim.h:
diff --git a/runtime/obj/operands.o b/runtime/obj/operands.o
index ac9c27b..055ec37 100644
Binary files a/runtime/obj/operands.o and b/runtime/obj/operands.o differ
diff --git a/runtime/obj/processor.d b/runtime/obj/processor.d
index fff7635..d93af2d 100644
--- a/runtime/obj/processor.d
+++ b/runtime/obj/processor.d
@@ -23,9 +23,8 @@
  /home/andyl/vortex/sim/simx/core.h \
  /home/andyl/vortex/sim/simx/emulator.h \
  /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
- /home/andyl/vortex/sim/simx/instr_trace.h \
  /home/andyl/vortex/sim/simx/pipeline.h \
+ /home/andyl/vortex/sim/simx/instr_trace.h \
  /home/andyl/vortex/sim/simx/ibuffer.h \
  /home/andyl/vortex/sim/simx/scoreboard.h \
  /home/andyl/vortex/sim/simx/operands.h \
@@ -59,9 +58,8 @@
 /home/andyl/vortex/sim/simx/core.h:
 /home/andyl/vortex/sim/simx/emulator.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
-/home/andyl/vortex/sim/simx/instr_trace.h:
 /home/andyl/vortex/sim/simx/pipeline.h:
+/home/andyl/vortex/sim/simx/instr_trace.h:
 /home/andyl/vortex/sim/simx/ibuffer.h:
 /home/andyl/vortex/sim/simx/scoreboard.h:
 /home/andyl/vortex/sim/simx/operands.h:
diff --git a/runtime/obj/processor.o b/runtime/obj/processor.o
index 95c4cd2..1331b2c 100644
Binary files a/runtime/obj/processor.o and b/runtime/obj/processor.o differ
diff --git a/runtime/obj/socket.d b/runtime/obj/socket.d
index 893b78e..c794111 100644
--- a/runtime/obj/socket.d
+++ b/runtime/obj/socket.d
@@ -20,9 +20,8 @@
  /home/andyl/vortex/sim/simx/core.h \
  /home/andyl/vortex/sim/simx/emulator.h \
  /home/andyl/vortex/sim/common/mem.h /home/andyl/vortex/sim/simx/instr.h \
- /home/andyl/vortex/sim/simx/tensor_unit.h \
- /home/andyl/vortex/sim/simx/instr_trace.h \
  /home/andyl/vortex/sim/simx/pipeline.h \
+ /home/andyl/vortex/sim/simx/instr_trace.h \
  /home/andyl/vortex/sim/simx/ibuffer.h \
  /home/andyl/vortex/sim/simx/scoreboard.h \
  /home/andyl/vortex/sim/simx/operands.h \
@@ -54,9 +53,8 @@
 /home/andyl/vortex/sim/simx/emulator.h:
 /home/andyl/vortex/sim/common/mem.h:
 /home/andyl/vortex/sim/simx/instr.h:
-/home/andyl/vortex/sim/simx/tensor_unit.h:
-/home/andyl/vortex/sim/simx/instr_trace.h:
 /home/andyl/vortex/sim/simx/pipeline.h:
+/home/andyl/vortex/sim/simx/instr_trace.h:
 /home/andyl/vortex/sim/simx/ibuffer.h:
 /home/andyl/vortex/sim/simx/scoreboard.h:
 /home/andyl/vortex/sim/simx/operands.h:
diff --git a/runtime/obj/socket.o b/runtime/obj/socket.o
index 48e27cb..d7cc0e8 100644
Binary files a/runtime/obj/socket.o and b/runtime/obj/socket.o differ
diff --git a/runtime/obj/types.o b/runtime/obj/types.o
index a79ea9b..6b8586b 100644
Binary files a/runtime/obj/types.o and b/runtime/obj/types.o differ
diff --git a/runtime/simx_config.stamp b/runtime/simx_config.stamp
index 5bafbf9..1ba0e64 100644
--- a/runtime/simx_config.stamp
+++ b/runtime/simx_config.stamp
@@ -1 +1 @@
--std=c++17 -Wall -Wextra -Wfatal-errors -fPIC -Wno-maybe-uninitialized -I/home/andyl/vortex/sim/simx -I/home/andyl/vortex/sim/common -I/home/andyl/vortex/hw -I/home/andyl/vortex/third_party/softfloat/source/include -I/home/andyl/vortex/third_party/ramulator/ext/spdlog/include -I/home/andyl/vortex/third_party/ramulator/ext/yaml-cpp/include -I/home/andyl/vortex/third_party/ramulator/src -DXLEN_32 -DEXT_TCU_ENABLE -DNUM_CORES=4 -DNUM_WARPS=4 -DNUM_THREADS=8 -DPERF_ENABLE -O2 -DNDEBUG -MMD -MP -MF /home/andyl/vortex/runtime/simx/../simx_config.stamp
+-std=c++17 -Wall -Wextra -Wfatal-errors -fPIC -Wno-maybe-uninitialized -I/home/andyl/vortex/sim/simx -I/home/andyl/vortex/sim/common -I/home/andyl/vortex/hw -I/home/andyl/vortex/third_party/softfloat/source/include -I/home/andyl/vortex/third_party/ramulator/ext/spdlog/include -I/home/andyl/vortex/third_party/ramulator/ext/yaml-cpp/include -I/home/andyl/vortex/third_party/ramulator/src -DXLEN_32  -g -O0 -DDEBUG_LEVEL=3 -MMD -MP -MF /home/andyl/vortex/runtime/simx/../simx_config.stamp
diff --git a/runtime/simx_rt_config.stamp b/runtime/simx_rt_config.stamp
index ae6d04c..7effd21 100644
--- a/runtime/simx_rt_config.stamp
+++ b/runtime/simx_rt_config.stamp
@@ -1 +1 @@
--std=c++17 -Wall -Wextra -Wfatal-errors -fPIC -Wno-maybe-uninitialized -I/home/andyl/vortex/runtime/include -I../common -I/home/andyl/vortex/hw -I/home/andyl/vortex/sim/simx -I/home/andyl/vortex/sim/common -I/home/andyl/vortex/runtime/common -DXLEN_32 -DEXT_TCU_ENABLE -DNUM_CORES=4 -DNUM_WARPS=4 -DNUM_THREADS=8 -DPERF_ENABLE -O2 -DNDEBUG
+-std=c++17 -Wall -Wextra -Wfatal-errors -fPIC -Wno-maybe-uninitialized -I/home/andyl/vortex/runtime/include -I../common -I/home/andyl/vortex/hw -I/home/andyl/vortex/sim/simx -I/home/andyl/vortex/sim/common -I/home/andyl/vortex/runtime/common -DXLEN_32  -g -O0
diff --git a/sim/simx/emulator.cpp b/sim/simx/emulator.cpp
index 3eb62f9..35fe248 100644
--- a/sim/simx/emulator.cpp
+++ b/sim/simx/emulator.cpp
@@ -36,6 +36,8 @@ warp_t::warp_t(uint32_t num_threads)
   , tmask(num_threads)
   , PC(0)
   , uuid(0)
+  , csr()
+  , in_trap_handler(false)
 {}
 
 void warp_t::reset(uint64_t startup_addr) {
@@ -44,6 +46,9 @@ void warp_t::reset(uint64_t startup_addr) {
   this->uuid = 0;
   this->fcsr = 0;
 
+  this->csr = warp_csr_state_t();
+  this->in_trap_handler = false;
+
   for (auto& reg_file : this->ireg_file) {
     for (auto& reg : reg_file) {
     #ifndef NDEBUG
@@ -137,6 +142,57 @@ void Emulator::attach_ram(RAM* ram) {
 #endif
 }
 
+void Emulator::raise_trap(uint32_t wid, ExcCause cause, Word tval) {
+  auto& warp = warps_.at(wid);
+
+  // Save faulting PC (PC of the instruction that caused the trap)
+  warp.csr.sepc   = warp.PC;
+  warp.csr.scause = static_cast<Word>(cause);
+  warp.csr.stval  = static_cast<Word>(tval);
+
+  warp.in_trap_handler = true;
+
+  // If no handler is installed, fall back to killing the warp
+  if (warp.csr.stvec == 0) {
+    DP(1, "raise_trap: wid=" << wid
+          << " cause=" << cause
+          << " with stvec=0, killing warp");
+    active_warps_.reset(wid);
+    stalled_warps_.reset(wid);
+    return;
+  }
+
+  DP(1, "raise_trap: wid=" << wid
+        << " cause=" << cause
+        << " sepc=0x" << std::hex << warp.csr.sepc
+        << " stvec=0x" << warp.csr.stvec
+        << " tval=0x" << tval << std::dec);
+
+  // Clear any remaining micro-ops from the old context
+  warp.ibuffer.clear();
+
+  // Optional: clear ipdom stack so trap executes as a straight-line region
+  while (!warp.ipdom_stack.empty()) {
+    warp.ipdom_stack.pop();
+  }
+
+  warp.PC = warp.csr.stvec;
+}
+
+void Emulator::return_from_trap(uint32_t wid) {
+  auto& warp = warps_.at(wid);
+
+  DP(1, "return_from_trap: wid=" << wid
+        << " sepc=0x" << std::hex << warp.csr.sepc << std::dec);
+
+  // Return to saved PC (faulting instruction PC); handler decides whether to replay or skip
+  warp.PC = warp.csr.sepc;
+  warp.in_trap_handler = false;
+
+  // Clear any left-over micro-ops from handler
+  warp.ibuffer.clear();
+}
+
 uint32_t Emulator::fetch(uint32_t wid, uint64_t uuid) {
   auto& warp = warps_.at(wid);
   __unused(uuid);
@@ -446,6 +502,13 @@ Word Emulator::get_csr(uint32_t addr, uint32_t wid, uint32_t tid) {
   case VX_CSR_MNSTATUS:
   case VX_CSR_MCAUSE:
     return 0;
+  
+  case csr::SSTATUS:  return warps_.at(wid).csr.sstatus;
+  case csr::STVEC:    return warps_.at(wid).csr.stvec;
+  case csr::SSCRATCH: return warps_.at(wid).csr.sscratch;
+  case csr::SEPC:     return warps_.at(wid).csr.sepc;
+  case csr::SCAUSE:   return warps_.at(wid).csr.scause;
+  case csr::STVAL:    return warps_.at(wid).csr.stval;
 
   case VX_CSR_FFLAGS: return warps_.at(wid).fcsr & 0x1F;
   case VX_CSR_FRM:    return (warps_.at(wid).fcsr >> 5);
@@ -569,6 +632,24 @@ Word Emulator::get_csr(uint32_t addr, uint32_t wid, uint32_t tid) {
 void Emulator::set_csr(uint32_t addr, Word value, uint32_t wid, uint32_t tid) {
   __unused (tid);
   switch (addr) {
+  case csr::SSTATUS:
+    warps_.at(wid).csr.sstatus = value;
+    break;
+  case csr::STVEC:
+    warps_.at(wid).csr.stvec = value;
+    break;
+  case csr::SSCRATCH:
+    warps_.at(wid).csr.sscratch = value;
+    break;
+  case csr::SEPC:
+    warps_.at(wid).csr.sepc = value;
+    break;
+  case csr::SCAUSE:
+    warps_.at(wid).csr.scause = value;
+    break;
+  case csr::STVAL:
+    warps_.at(wid).csr.stval = value;
+    break;
   case VX_CSR_FFLAGS:
     warps_.at(wid).fcsr = (warps_.at(wid).fcsr & ~0x1F) | (value & 0x1F);
     break;
@@ -625,9 +706,11 @@ void Emulator::update_fcrs(uint32_t fflags, uint32_t wid, uint32_t tid) {
 // Therefore, without these instructions, undefined and incorrect behavior happens
 //
 // For now, we need these instructions to trap for testing the riscv-vector isa
-void Emulator::trigger_ecall() {
-  active_warps_.reset();
-}
-void Emulator::trigger_ebreak() {
-  active_warps_.reset();
+void Emulator::trigger_ecall(uint32_t wid) {
+  // Treat every ECALL as an S-mode ecall for now
+  this->raise_trap(wid, ExcCause::EcallFromSMode, 0);
 }
+
+void Emulator::trigger_ebreak(uint32_t wid) {
+  this->raise_trap(wid, ExcCause::Breakpoint, 0);
+}
\ No newline at end of file
diff --git a/sim/simx/emulator.h b/sim/simx/emulator.h
index 0fb1e0b..713e71a 100644
--- a/sim/simx/emulator.h
+++ b/sim/simx/emulator.h
@@ -51,6 +51,29 @@ struct ipdom_entry_t {
 
 ///////////////////////////////////////////////////////////////////////////////
 
+struct warp_csr_state_t {
+  Word sstatus;
+  Word stvec;
+  Word sscratch;
+  Word sepc;
+  Word scause;
+  Word stval;
+
+  warp_csr_state_t()
+    : sstatus(0)
+    , stvec(0)
+    , sscratch(0)
+    , sepc(0)
+    , scause(0)
+    , stval(0)
+  {}
+};
+
+
+///////////////////////////////////////////////////////////////////////////////
+
+///////////////////////////////////////////////////////////////////////////////
+
 struct warp_t {
   std::vector<std::vector<Word>>    ireg_file;
   std::vector<std::vector<uint64_t>>freg_file;
@@ -61,6 +84,9 @@ struct warp_t {
   Byte                              fcsr;
   uint32_t                          uuid;
 
+  warp_csr_state_t                  csr;
+  bool                              in_trap_handler;
+
   warp_t(uint32_t num_threads);
 
   void reset(uint64_t startup_addr);
@@ -68,6 +94,7 @@ struct warp_t {
 
 ///////////////////////////////////////////////////////////////////////////////
 
+
 struct wspawn_t {
   bool      valid;
   uint32_t  num_warps;
@@ -86,6 +113,10 @@ public:
 
   void attach_ram(RAM* ram);
 
+  void raise_trap(uint32_t wid, ExcCause cause, Word tval);
+
+  void return_from_trap(uint32_t wid);
+
 #ifdef VM_ENABLE
   void set_satp(uint64_t satp) ;
 #endif
@@ -138,8 +169,9 @@ private:
 
   // temporarily added for riscv-vector tests
   // TODO: remove once ecall/ebreak are supported
-  void trigger_ecall();
-  void trigger_ebreak();
+  void trigger_ecall(uint32_t wid);
+  void trigger_ebreak(uint32_t wid);
+
 
   const Arch& arch_;
   const DCRS& dcrs_;
diff --git a/sim/simx/execute.cpp b/sim/simx/execute.cpp
index 4e3d880..9f0cf3d 100644
--- a/sim/simx/execute.cpp
+++ b/sim/simx/execute.cpp
@@ -168,6 +168,9 @@ instr_trace_t* Emulator::execute(const Instr &instr, uint32_t wid) {
 #endif // XLEN_64
 
   bool rd_write = false;
+  // control-flow override flags for traps
+  bool took_trap = false; // ECALL/EBREAK
+  bool did_sret  = false; // SRET/URET/MRET
 
   visit_var(op_type,
     [&](AluType alu_type) {
@@ -495,22 +498,30 @@ instr_trace_t* Emulator::execute(const Instr &instr, uint32_t wid) {
         trace->fetch_stall = true;
         rd_write = true;
       } break;
-      case BrType::SYS:
+      case BrType::SYS: {
+        // System instructions: ECALL/EBREAK/SRET
+        trace->fetch_stall = true;  // treat like a control-flow change
+
         switch (brArgs.offset) {
         case 0x000: // RV32I: ECALL
-          this->trigger_ecall();
+          this->trigger_ecall(wid);
+          took_trap = true;
           break;
         case 0x001: // RV32I: EBREAK
-          this->trigger_ebreak();
+          this->trigger_ebreak(wid);
+          took_trap = true;
           break;
         case 0x002: // RV32I: URET
         case 0x102: // RV32I: SRET
-        case 0x302: // RV32I: MRET
+        case 0x302: { // RV32I: MRET
+          this->return_from_trap(wid);
+          did_sret = true;
+        } 
           break;
         default:
           std::abort();
         }
-        break;
+      }break;
       default:
         std::abort();
       }
@@ -1554,11 +1565,22 @@ instr_trace_t* Emulator::execute(const Instr &instr, uint32_t wid) {
     }
   }
 
-  warp.PC += 4;
+  // warp.PC += 4;
+
+  // if (warp.PC != next_pc) {
+  //   DP(3, "*** Next PC=0x" << std::hex << next_pc << std::dec);
+  //   warp.PC = next_pc;
+  // }
 
-  if (warp.PC != next_pc) {
-    DP(3, "*** Next PC=0x" << std::hex << next_pc << std::dec);
-    warp.PC = next_pc;
+  if (!took_trap && !did_sret) {
+    warp.PC += 4;
+
+    if (warp.PC != next_pc) {
+      DP(3, "*** Next PC=0x" << std::hex << next_pc << std::dec);
+      warp.PC = next_pc;
+    }
+  } else {
+    DP(3, "*** PC set by trap/return: 0x" << std::hex << warp.PC << std::dec);
   }
 
   if (warp.tmask != next_tmask) {
diff --git a/sim/simx/types.h b/sim/simx/types.h
index e6904b1..e368732 100644
--- a/sim/simx/types.h
+++ b/sim/simx/types.h
@@ -479,6 +479,61 @@ inline std::ostream &operator<<(std::ostream &os, const CsrType& type) {
 
 ///////////////////////////////////////////////////////////////////////////////
 
+enum class ExcCause : uint32_t {
+  None                = 0xffffffffu,
+
+  InstrAddrMisaligned = 0,
+  InstrAccessFault    = 1,
+  IllegalInstr        = 2,
+  Breakpoint          = 3,
+  LoadAddrMisaligned  = 4,
+  LoadAccessFault     = 5,
+  StoreAddrMisaligned = 6,
+  StoreAccessFault    = 7,
+  EcallFromUMode      = 8,
+  EcallFromSMode      = 9,
+  EcallFromMMode      = 11,
+  InstrPageFault      = 12,
+  LoadPageFault       = 13,
+  StorePageFault      = 15,
+  GpuSyntheticFault   = 0x100
+};
+
+inline std::ostream &operator<<(std::ostream &os, const ExcCause& cause) {
+  switch (cause) {
+  case ExcCause::None:                os << "None"; break;
+  case ExcCause::InstrAddrMisaligned: os << "InstrAddrMisaligned"; break;
+  case ExcCause::InstrAccessFault:    os << "InstrAccessFault"; break;
+  case ExcCause::IllegalInstr:        os << "IllegalInstr"; break;
+  case ExcCause::Breakpoint:          os << "Breakpoint"; break;
+  case ExcCause::LoadAddrMisaligned:  os << "LoadAddrMisaligned"; break;
+  case ExcCause::LoadAccessFault:     os << "LoadAccessFault"; break;
+  case ExcCause::StoreAddrMisaligned: os << "StoreAddrMisaligned"; break;
+  case ExcCause::StoreAccessFault:    os << "StoreAccessFault"; break;
+  case ExcCause::EcallFromUMode:      os << "EcallFromUMode"; break;
+  case ExcCause::EcallFromSMode:      os << "EcallFromSMode"; break;
+  case ExcCause::EcallFromMMode:      os << "EcallFromMMode"; break;
+  case ExcCause::InstrPageFault:      os << "InstrPageFault"; break;
+  case ExcCause::LoadPageFault:       os << "LoadPageFault"; break;
+  case ExcCause::StorePageFault:      os << "StorePageFault"; break;
+  case ExcCause::GpuSyntheticFault:   os << "GpuSyntheticFault"; break;
+  default:
+    assert(false);
+  }
+  return os;
+}
+
+namespace csr {
+  static constexpr uint32_t SSTATUS  = 0x100;
+  static constexpr uint32_t STVEC    = 0x105;
+  static constexpr uint32_t SSCRATCH = 0x140;
+  static constexpr uint32_t SEPC     = 0x141;
+  static constexpr uint32_t SCAUSE   = 0x142;
+  static constexpr uint32_t STVAL    = 0x143;
+}
+
+///////////////////////////////////////////////////////////////////////////////
+
 enum class VsetType {
   VSETVLI,
   VSETIVLI,
